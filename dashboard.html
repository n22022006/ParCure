<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParCure - Patient Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/sections/dashboard.css">
    <!-- Onboarding redirect check (Firebase v9 modular) -->
    <script type="module" src="js/onboarding-check.js"></script>
</head>
<body>
        <!-- Dashboard Page -->
        <header class="pc-header" role="banner">
            <div class="pc-header-inner">
                <div class="pc-brand">
                    <div class="pc-logo" aria-label="ParCure">ParCure</div>
                    <span class="pc-name"></span>
                </div>
                <div class="pc-actions">
                    <button id="pcAvatarBtn" class="pc-avatar" aria-haspopup="menu" aria-expanded="false" title="User menu">ðŸ‘¤</button>
                </div>
            </div>
            <nav id="pcDropdown" class="pc-dropdown" aria-label="Profile Menu" role="menu">
                <div class="pc-menu-item" role="menuitem" id="menuViewProfile">View Profile</div>
                <div class="pc-menu-item" role="menuitem" id="menuEditAccount">Edit Account</div>
                <div class="pc-menu-item" role="menuitem" id="menuHelp">Help & Support</div>
                <div class="pc-menu-item" role="menuitem" id="menuContact">Contact Us</div>
                <div class="pc-menu-item" role="menuitem" id="menuLogout">Logout</div>
            </nav>
        </header>

        <main class="pc-container" role="main">
            <!-- Hero Greeting -->
            <section class="pc-hero" aria-label="Welcome">
                <div class="pc-hero-image" aria-hidden="true"></div>
                <div class="pc-hero-content">
                    <h2 id="greetingMessage" class="pc-hero-title">Welcome</h2>
                    <p id="greetingName" class="pc-hero-name">User</p>
                </div>
            </section>

            <!-- Action Cards -->
            <section class="pc-actions-grid" aria-label="Primary Actions">
                <div class="pc-card card-exercise" id="exerciseBlock">
                    <div class="pc-card-content">
                        <h3 class="pc-card-title">Exercise</h3>
                        <p class="pc-card-desc">Start today's guided exercises</p>
                    </div>
                    <div class="pc-card-arrow">â†’</div>
                </div>
                <div class="pc-card card-diet" id="dietBlock">
                    <div class="pc-card-content">
                        <h3 class="pc-card-title">Diet</h3>
                        <p class="pc-card-desc">View meals and nutrition plan</p>
                    </div>
                    <div class="pc-card-arrow">â†’</div>
                </div>
                <div class="pc-card card-saathi" id="saathiBlock">
                    <div class="pc-card-content">
                        <h3 class="pc-card-title">Saathi</h3>
                        <p class="pc-card-desc">Talk to your health companion</p>
                    </div>
                    <div class="pc-card-arrow">â†’</div>
                </div>
                <div class="pc-card card-reports" id="reportsBlock">
                    <div class="pc-card-content">
                        <h3 class="pc-card-title">Reports</h3>
                        <p class="pc-card-desc">View health and progress reports</p>
                    </div>
                    <div class="pc-card-arrow">â†’</div>
                </div>
            </section>
        </main>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner hidden">
        <div class="spinner"></div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="modal hidden">
        <div class="modal-content">
            <h3>Message</h3>
            <p id="errorMessage"></p>
            <button class="btn btn-primary" onclick="closeErrorModal()">Close</button>
        </div>
    </div>

    <!-- Utility Functions -->
    <script>
        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            if (show) {
                spinner.classList.remove('hidden');
            } else {
                spinner.classList.add('hidden');
            }
        }

        function showError(message) {
            const errorModal = document.getElementById('errorModal');
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorModal.classList.remove('hidden');
        }

        function closeErrorModal() {
            document.getElementById('errorModal').classList.add('hidden');
        }

        // Toggle task completion
        function toggleTask(element) {
            const checkbox = element.querySelector('.task-checkbox');
            checkbox.checked = !checkbox.checked;
            element.classList.toggle('completed');
        }

        

        // Saathi button handler - navigate to chatbot
        function openSaathi() {
            window.location.href = 'saathi.html';
        }

        // Initialize action block handlers
        document.addEventListener('DOMContentLoaded', () => {
            // Time-based greeting background image (precise ranges)
            const heroImageEl = document.querySelector('.pc-hero-image');
            if (heroImageEl) {
                const hour = new Date().getHours(); // 0..23
                let period = 'morning';
                if (hour >= 5 && hour < 12) {
                    period = 'morning';
                } else if (hour >= 12 && hour < 17) {
                    period = 'afternoon';
                } else if (hour >= 17 && hour < 20) {
                    period = 'evening';
                } else {
                    period = 'night';
                }

                const imagesByPeriod = {
                    morning: 'images/morning.jpeg',
                    afternoon: 'images/afternoon2.jpg',
                    evening: 'images/evening2.jpg',
                    night: 'images/night2.jpg'
                };
                const chosen = imagesByPeriod[period] || imagesByPeriod.morning;
                heroImageEl.style.backgroundImage = `url('${chosen}')`;
            }

            const saathiBlock = document.getElementById('saathiBlock');
            if (saathiBlock) {
                saathiBlock.addEventListener('click', openSaathi);
            }

            const dietBlock = document.getElementById('dietBlock');
            if (dietBlock) {
                dietBlock.addEventListener('click', () => {
                    window.location.href = 'diet.html';
                });
            }

            const exerciseBlock = document.getElementById('exerciseBlock');
            if (exerciseBlock) {
                exerciseBlock.addEventListener('click', () => {
                    window.location.href = 'exercise.html';
                });
            }

            const reportsBlock = document.getElementById('reportsBlock');
            if (reportsBlock) {
                reportsBlock.addEventListener('click', () => {
                    window.location.href = 'report.html';
                });
            }
        });
    </script>

        <!-- Dashboard Scripts -->
        <script src="js/dashboard.js"></script>
        <script src="js/ui-dashboard.js"></script>
        <script type="module">
            import { getFirebase } from './js/firebase-v9.js';
            import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
            import { ref, get } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js';
            const nameEl = document.getElementById('greetingName');
            const localName = localStorage.getItem('pc_user_name');
            if (localName && nameEl) nameEl.textContent = localName;
            try {
                const { auth, rtdb } = getFirebase();
                onAuthStateChanged(auth, async (user) => {
                    if (!user) return;
                    try {
                        const snap = await get(ref(rtdb, 'users/' + user.uid + '/profile'));
                        const profile = snap.exists() ? snap.val() : {};
                        const name = profile.name || profile.fullName || localName || 'Friend';
                        localStorage.setItem('pc_user_name', name);
                        if (nameEl) nameEl.textContent = name;
                    } catch (e) { /* ignore */ }
                });
            } catch (e) { /* ignore */ }
        </script>
      
        
</body>
</html>
